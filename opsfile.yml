version: 3


tasks:


  cli:
    silent: true
    desc: python repl
    cmds:
    - |
      if {{.__ide}}
      then ~/.ops/miniconda3/bin/ptipython
      else python -m IPython
      fi

  ask:
    desc: ask to the AI (LLama3)
    silent: true
    cmds:
    - |
      args={{._args_}}
      set -- ${args[@]}
      test "$1" = "--" && shift
      python  scripts/ask.py  -{{.__model}} "$@"

  chat:
    desc: chat with the AI
    cmds:
    - python scripts/chat.py -{{.__model}}

  notebook:
    desc: notebook    
    dir: $OPS_PWD/notebook
    env: 
      HF_HOME: 
        sh: echo $OPS_PWD/workspace
    cmds:
    - mkdir -p  $OPS_PWD/workspace
    -  ~/.ops/miniconda3/bin/jupyter notebook

  upload:
    desc: upload workspace
    cmds:
    - which rclone
    - |
      set -o allexport
      source $OPS_PWD/.env
      envsubst <rclone.conf >_rclone.conf
      rclone -v --config _rclone.conf copy -L $OPS_PWD/workspace s3://$AWS_BUCKET/workspace


  img:
    desc: generate images (SDXL)
    silent: true
    cmds:
    - |
      args={{._args_}}
      set -- ${args[@]}
      test "$1" = "--" && shift
      python scripts/img.py --dir "$OPS_PWD/images" "$@"


  codegen:
    desc: generate code
    silent: true
    cmds:
    - |
      python scripts/codegen.py "$OPS_PWD/codegen" "$@"
